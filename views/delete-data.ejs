<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Deletion - Recipe by Risa</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="data-deletion-page">

    <!-- Include Header -->
    <%- include('partials/header') %>

    <!-- Spacer to push content down -->
    <div style="height: 150px;"></div>

    <main class="deletion-container">
        <h1>Data Deletion Request</h1>
        <p>If you wish to delete your account and personal data from Recipe by Risa, please enter your email and submit a request.</p>

        <!-- Deletion Form -->
        <form id="dataDeletionForm">
            <label for="email">Enter Your Email:</label>
            <input type="email" id="email" name="email" required placeholder="example@example.com">
            <button type="submit">Request Data Deletion</button>
        </form>

        <p>Alternatively, you can email us at <a href="mailto:yegorkushnir1@gmail.com">yegorkushnir1@gmail.com</a> to request account deletion.</p>
    </main>

    <!-- Deletion Confirmation Popup -->
    <div id="confirmationPopup" class="popup-overlay" style="display: none;">
        <div class="popup-box">
            <p>Are you sure you want to delete your account? Your account information will not be recoverable.</p>
            <button id="confirmDelete">Yes, Delete</button>
            <button id="cancelDelete">No, Cancel</button>
        </div>
    </div>

    <script>
        document.getElementById("dataDeletionForm").addEventListener("submit", function(event) {
            event.preventDefault(); // Prevent form from submitting immediately
            document.getElementById("confirmationPopup").style.display = "block";
        });

        // Handle Popup Buttons
        document.getElementById("cancelDelete").addEventListener("click", function() {
            document.getElementById("confirmationPopup").style.display = "none"; // Close popup
        });

        document.getElementById("confirmDelete").addEventListener("click", async function() {
            document.getElementById("confirmationPopup").style.display = "none"; // Close popup
            const email = document.getElementById("email").value;

            const response = await fetch("/delete-account", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email })
            });

            const result = await response.json();
            alert(result.message);
            if (result.success) {
                window.location.href = "/"; // Redirect to home after deletion
            }
        });
    </script>

    <!-- Include Footer -->
    <footer class="site-footer">
        <div class="footer-container">
            <p>&copy; 2025 Recipe by Risa. All rights reserved.</p>
        </div>
    </footer>

</body>
</html>
